SEIMS 建模数据准备
----------------
prepared by Liang-Jun Zhu

First Release : 2015-6-20 v1.0

Revised date  : 2016-5-31 v2.0

----------------

流域过程模型是根据流域内基础地理信息数据、气象数据、水文数据等对流域产流、侵蚀、污染迁移等过程进行合理概化、模拟。

为了使模型模拟更接近真实流域过程，我们需要准备一系列建模数据，主要包括：**降水**、**气象**、**空间数据**（DEM、土地利用图、土壤类型图）、**管理措施数据**等。

接下来，分别对准备数据的搜集、整理加以介绍。

# 目录
0. [基本约定](#0-基本约定)

1. [降水数据](#1-降水数据)

2. [气象数据](#2-气象数据)

3. [空间数据](#3-空间数据)
	1. [DEM,Outlet](#31-dem-outlet-optional)
	
	2. [气象站点泰森多边形](#32-气象站点泰森多边形)
	
	2. [土壤数据](#33-土壤类别序列及属性查找表)
	
	3. [土地利用数据](#34-土地利用数据及属性查找表) 
	
	4. [植被覆盖数据](#35-植被覆盖数据及属性查找表)

## 0. 基本约定

文本格式的准备数据格式有如下基本约定：
+ `#`为注释行，第一行为“时制和时区”时例外
+ `,`为每行数据内，属性值之间的分割
+ '-'为每个属性值内部的一级分割
+ ':'为每个属性值内部的二级分割
如：
```shell
#LOCALTIME 8
# This line is comment.
SUBSCENARIO,NAME,LANDUSE,PARAMETERS
1,fengjin,7-16,Interc_max:Maximum Interception Capacity:AC:1-Conductivity:Soil hydraulic conductivity:RC:3.5
```
上述示例中的最后一行解析成数据字典格式如下：
```python
demo_dict = {
    'SUBSCENARIO': 1,
    'NAME':'fengjin'
    'LANDUSE': [7, 16],
    'PARAMETERS': [
        ['Interc_max', 'Maximum Interception Capacity', 'AC', 1],
        ['Conductivity', 'Soil hydraulic conductivity', 'RC', 3.5]        
    ]
}
```

## 1. 降水数据

+ 降水站点信息

站点信息包括 站点编号(整型)、站点名称(字符串)、投影系X坐标及Y坐标、投影系ID(可设为0)、经纬度、椭球体ID(可设为0)以及高程，如下表所示，站点信息保存为txt格式，如`SEIMS/model_data/model_dianbu_30m_longterm/data_prepare/climate/Sites_P.txt`:

|StationID|Name|LocalX|LocalY|LocalPrjID|Lon|Lat|DatumID|Elevation|
|----|----|----|----|----|----|----|----|----|
|62915310|GuanWan|39548201.84|3543440.687|0|117.525278|32.025556|0|43|
|...|||||||||

+ 降水数据
	+ 每个Sheet名对应一个`Sites_P.txt`内的站点名
	+ 每个Sheet按照月(col)*日(row)的二维表形式组织数据
	+ 降雨数据单位为毫米(mm)


> TODO: 可将目前这种EXCEL组织形式修改为txt格式
>       具体可参照SWAT降水数据的输入格式

[返回目录](#目录)

## 2. 气象数据

+ 气象站点信息

格式与降水站点一致，如`SEIMS/model_data/model_dianbu_30m_longterm/data_prepare/climate/Sites_M.txt`:

|StationID|Name|LocalX|LocalY|LocalPrjID|Lon|Lat|DatumID|Elevation|
|----|----|----|----|----|----|----|----|----|
|58321|hefei|39535576.056|3536052.03009|0|117.23|31.87|0|20|
|...|||||||||

+ 气象数据(**日值**)
	+ StationID: 必需，站点编号(整型)
	+ Y, M, D  : 必需，年/月/日
	+ TMAX     : 必需，最高气温(deg C)
	+ TMIN     : 必需，最低气温(deg C)
	+ TMEAN    : 可选，平均气温(deg C)，缺失情况下，由(TMAX+TMIN)/2计算
	+ RM       : 必需，相对湿度(%)
	+ WS       : 必需，风速(m/s)
	+ SR/SSD   : 二选一，太阳辐射(MJ/m2/day)/日照时数(h)
	+ PET      : 可选，蒸散发(mm)

> 1.气象数据中各属性列的前后顺序没有固定要求，随意排列即可！
> 2.**表头必须要有且与上述名称一致**，

保存为text格式文件，如`meteorology_dianbu_daily.txt`，下表：

|StationID|Y|M|D|TMEAN|TMAX|TMIN|RM|WS|SSD|
|----|----|----|----|----|----|----|----|----|----|
|58321|2014|1|1|5.6|16.3|-2.4|56.0|1.4|7.4|
|58321|2014|1|2|7.5|17.3|-0.6|58.0|1.2|6.9|
|...|||||||||

[返回目录](#目录)

## 3. 空间数据

> 1.所有空间数据的分辨率及空间投影坐标系必须一致！
> 
> 2.数据准备阶段，各个数据的EXTENT可以不一致，但都必须大于流域边界

### 3.1 DEM, Outlet (Optional)

DEM是最基础也是最重要的空间数据，SEIMS模型调用[TauDEM](http://hydrology.usu.edu/taudem/taudem5/)实现流域分割、地形参数提取。

流域出口Shapefile数据为可选，缺省状态下，以当前区域汇流累积量最大值的点作为流域出口。

[返回目录](#目录)

### 3.2 气象站点泰森多边形

气象站点泰森多边形用于判断研究区内用到的降水站点、气象站点。准备数据为ESRI Shapefile格式，如`SEIMS/model_data/model_dianbu_30m_longterm/data_prepare/spatial`内的`Preci_dianbu_Vor.shp`和`Metero_hefei_Vor.shp`。

> TODO: 准备泰森多边形的意义仅在于此，能否考虑其他更加便捷的方式确定研究区所用的气象数据站点？

[返回目录](#目录)

### 3.3 土壤类别序列及属性查找表

土壤类别序列图（如`soil_SEQN.tif`）为该研究区内土壤属性不同的类型图，也即**不一定要求与土壤类型完全一致**。

比如，研究区内有 A、B、C三种类型的土壤，但是由于地形等原因，土壤类型内属性差异较大，因此，可以根据一些条件制作出A1、A2、B1、B2、B3、C六种土壤类别序列图。

类别序列以整型数字表示，必需的土壤属性由一个属性查找表提供（如`soil_properties_lookup.txt`），其基本格式如下：

+ 土壤类别序列的属性查找表部分属性介绍：
	+ SEQN: 必需，类别序列编号(整型)
	+ NAME: 必需，类别名称(字符串)
	+ NLAYERS: 必需，土壤层数
	+ SOL_Z: 必需， 土层底部至土壤表面厚度(mm), 比如: 100,400,800
	+ SOL_OM: 必需，有机质含量(%)
	+ SOL_CLAY: 必需，美国制粘粒含量(%), < 0.002 mm
	+ SOL_SILT: 必需，美国制粉粒含量(%), 0.002 ~ 0.05 mm
	+ SOL_SAND: 必需，美国制砂粒含量(%), 0.05 ~ 2 mm
	+ SOL_ROCK: 必需，美国制石块含量(%), > 2 mm
	+ **可选属性列表略**

> 1.NLAYERS对不同土壤允许不同
> 
> 2.对于多层属性数据，土层自上而下属性间以逗号(,)分隔
> 
> 3.可选属性缺省状态下，由必需属性通过经验公式计算得到
> 
> 4.土壤初始化学参数由经验公式计算得到
> 
> 5.与日值气象数据准备一样，各属性列的排列顺序可以随意，但必需包含表头且属性列名称与上述介绍一致。

下表为简单示例：

|SEQN|SNAM|NLAYERS|SOL_ZMX|SOL_Z|SOL_BD|SOL_OM|CLAY|SILT|SAND|ROCK|
|----|----|----|----|----|----|----|----|----|----|----|
|1|Chengbaitutian|4|180|130,230,520,1000|1.19,-9999,-9999,-9999|1.66,0.57,0.36,0.43|14.22,16.9,52.32,50.04|53.59,50.6,44.88,47.06|32.19,32.5,2.8,2.9|0,0,0,0|
|2|Huangbaitutian_h|2|230|140,230|-9999,-9999|1.18,0.76|15.64,16.95|52.62,51.93|31.74,31.12|0,0|
|3|Huangbaitutian_s|3|230|160,290,1000|1.23,1.58,-9999|1.65,0.55,0.79|25.92,23.66,23.32|51.07,50.72,75.14|23.01,25.62,1.54|0,0,0|

[返回目录](#目录)

### 3.4 土地利用数据及属性查找表

SEIMS采用SWAT模型的土地利用编码及属性查找表(`SEIMS\database\LanduseLookup.txt`)。

因此，需要将土地利用图：
+ 土地利用代码 -> SWAT土地利用代码
+ 矢量或栅格 -> 与DEM空间分辨率一致

[返回目录](#目录)

### 3.5 植被覆盖数据及属性查找表

植被覆盖数据（Crop）是进行生态过程模拟的关键输入，目前SEIMS模型根据土地利用确定植被覆盖数据，并利用SWAT数据库查表（`CropLookup.txt`）得到属性信息。

> TODO: 应当考虑植被覆盖数据的空间数据输入。


至此，SEIMS模型所需准备数据就完成了，下一步，可以[运行数据预处理程序](Data-preprocess)，并将所有数据导入MongoDB数据库，以供SEIMS运行调用。

[返回目录](#目录)