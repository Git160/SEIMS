<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>SEIMS: SEIMS开发规范</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SEIMS
   &#160;<span id="projectnumber">2.0-beta</span>
   </div>
   <div id="projectbrief">Spatially Explicit Integrated Modeling System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Packages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/d44/a00098.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SEIMS开发规范 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>开发规范的制定是为了保持模型代码的一致性和可读性。</li>
<li>开发规法包括代码风格统一和模块编写指南</li>
</ul>
<h2>1.代码风格规范</h2>
<h3>1.1.代码整理格式规范</h3>
<p>SEIMS模型主要编程语言为C/C++和Python，采用CMake组织代码。由于不同开发者所用的编辑器各异，因此我们基于Google代码格式规定了C/C++和Python的代码书写格式规范，位于<code>./doc/style</code>文件夹下。这两个文件分别可以导入CLion和PyCharm软件，使用菜单栏命令“Code”-&gt;“Reformation Code”便可以一键整理代码。</p>
<h3>1.2.禁用Tab键</h3>
<p>不同IDE对Tab键的显示不同，Visual Studio下排版漂亮的代码在其他IDE下很可能错位，因此**强烈建议**在VS中将**Tab键用4个空格代替**。</p>
<p>打开Visual Studio，设置“工具”-&gt;“选项”-&gt;“文本编辑器”-&gt;“C/C++”-&gt;“制表符”-&gt;“缩进”选择“智能”，“制表符大小”和“缩进大小”均为4，选中“插入空格”。</p>
<h3>1.3.不混用换行符</h3>
<p>众所周知，<code>Windows</code>系统和<code>Linux/Unix</code>系统的换行符不同，而<code>Windows</code>下的Git默认情况下会在提交代码时自动替换换行符<code>LF</code>或<code>CR</code>为<code>CRLF</code>，这样对跨平台代码造成了极大的不便。</p>
<p>因此，我们**强烈建议**代码采用<code>Linux</code>编码<code>LF</code>即<code>\n</code>，因此需要做到：</p>
<ul>
<li>VS或其他IDE设置换行符为LF而非CRLF</li>
<li>文本编辑器建议采用Notepad++，**禁止**使用Windows的记事本！</li>
</ul>
<p>打开Git shell进行如下设置：</p>
<p>``` </p>
<h1>AutoCRLF, 设置提交、检出时均不转换</h1>
<p>git config &ndash;global core.autocrlf false </p>
<h1>SafeCRLF, 设置拒绝提交包含混合换行符的文件，并且在提交混合换行符的文件时给出警告，从而手动转换为LF换行符后提交</h1>
<p>git config &ndash;global core.safecrlf true git config &ndash;global core.safecrlf warn ```</p>
<p>详见<a href="https://github.com/lreis2415/SEIMS2017/wiki/Git-guidance">Wiki-Github使用说明</a>。</p>
<h3>1.4.行宽</h3>
<p>行宽必须限制！！！</p>
<p>建议100字符为限，太长则应换行。</p>
<p>PyCharm中的设置为：File-&gt;Settings-&gt;Editor-&gt;Code Style-&gt;Default Opetions-&gt;Right margin (columns): 100</p>
<p>随后使用Code-&gt;Reformat Code (Ctrl+Alt+L)时便会自动换行了。当然自动的并不一定是最好的，还是需要自己手动调整。</p>
<h3>1.5.括弧</h3>
<p>在复杂的条件表达式中，用括弧清楚地表示逻辑优先级。</p>
<h3>1.6.断行与空白的花括号{}</h3>
<p>避免使用精简风格，如： ```cpp if (condition) DoSomething(); else DoSomethingElse(); ``` 虽然这样可以节省几行空间，但是对于单步调试查看各个变量的变化情况非常不便，因此推荐采用以下两种风格： ```cpp if (condition) { DoSomething(); } else { DoSomethingElse(); } ``` 或者 ```cpp if (condition) { DoSomething(); } else { DoSomethingElse(); } ```</p>
<h3>1.7.分行</h3>
<p>不要把多条语句放在一行！！！更严格地，不要把多个变量定义在一行，以下三行都是不可取的例子。</p>
<p>```cpp int a =1, b = 2; c = 3; d = 5.f; if (fFoo) Bar(); ```</p>
<h3>1.8.命名大小写</h3>
<p>采用一个通用的做法：所有的类型、类、函数名都用Pascal形式（即所有单词的第一个字母都大写），所有的变量都用Camel形式（即第一个单词全部小写，随后单词随Pascal形式，也称lowerCamel）。</p>
<ul>
<li>类、类型、变量采用名词或组合名词，如Member、productInfo等；</li>
<li>函数则用动词或动宾组合词来表示，如get/set、RenderPage()等。</li>
</ul>
<h3>1.9.注释规范</h3>
<ul>
<li>SEIMS采用Doxygen代码注释规范，在Visual Studio中配合VA Assist插件可高效插入注释，<a href="https://github.com/lreis2415/SEIMS/wiki/Develop-environment#%E5%BC%80%E5%8F%91%E8%BE%85%E5%8A%A9%E5%B7%A5%E5%85%B7-vassistx%E4%BB%8B%E7%BB%8D">查看详细配置</a>。**以下为补充Tips**。</li>
<li><code>#ifndef ... #endif</code>宏命令之后要注释上这是对应的哪个宏命令，以防嵌套使用时混淆不清，尤其是中间代码过长的时候，如： ```cpp #ifdef windows #define Tag_ModuleDirectoryName "\\" #define SEP "\\" #define Tag_DyLib ".dll" #else #define Tag_ModuleDirectoryName "/" #define SEP "/" #define Tag_So "lib" #endif /* windows #ifdef linux #define Tag_DyLib ".so" #elif (defined macos) || (defined macosold) #define Tag_DyLib ".dylib" #endif /* linux ```</li>
<li>SEIMS中Python代码注释采用Google风格的docstring，在PyCharm中设置为： <code>File --&gt; <a class="el" href="../../d7/dfc/a00349.html" title="Base class for input or output Settings. ">Settings</a> --&gt; Tools --&gt; Python Integrated Tools --&gt; Google</code> <h2>2.代码设计规范</h2>
</li>
</ul>
<p>建议阅读：<a href="http://zh-google-styleguide.readthedocs.io/en/latest/contents/">Google开源项目风格指南（中文版）</a> </p>
<h3>2.1.Python</h3>
<ul>
<li>运行pylint检查代码中潜在bug或警告，并改正。默认地，pylint会产生很多警告信息，有些是我们不希望看到的，可通过<code>--disable=</code>禁止，比如：<ul>
<li>变量、函数、类命名不规范，invalid-name (C0103)</li>
<li>函数参数过多（多于5个），虽然参数多了风格不好，但是对于变参数的函数设计来讲，参数多于5个很常见，too-many-arguments (R0913)</li>
<li>某个函数有太多局部变量，too-many-locals (R0914)</li>
<li>没必要的括弧，如为了兼容python3在print后加的括弧，superfluous-parens (C0325) ```bash pylint C: &ndash;files-output=y &ndash;disable=C0103,R0913,R0914,C0325 ```</li>
</ul>
</li>
<li>导入包或模块时，应使用模块的全路径，而非相对路径 ```python <h1>Spatial delineation</h1>
</li>
</ul>
<p>from seims.preprocess.sd_delineation import SpatialDelineation ```</p>
<ul>
<li>命名约定 <code>module_name, package_name, ClassName, method_name, ExceptionName, function_name, GLOBAL_VAR_NAME, instance_var_name, function_parameter_name, local_var_name.</code></li>
</ul>
<h2>3.Git分支管理</h2>
<h3>3.1.各分支命名规范及功能定义</h3>
<table class="doxtable">
<tr>
<th align="center">分支</th><th align="center">命名示例</th><th align="center">功能  </th></tr>
<tr>
<td align="center"><code>master</code></td><td align="center"><code>master</code></td><td align="center">稳定版本发布，非工作区，仅管理员可操作 </td></tr>
<tr>
<td align="center"><code>dev</code></td><td align="center"><code>dev</code></td><td align="center">开发汇总，非工作区，开发组成员均可将完成的工作合并至此，当<code>dev</code>足够稳定之后，合并至<code>master</code> </td></tr>
<tr>
<td align="center"><code>bug-&lt;bugcode&gt;-&lt;author&gt;</code></td><td align="center"><code>bug-ompconfused-zlj</code></td><td align="center">bug修复，临时工作区，修复并测试完成之后，将此分支合并至<code>dev</code>，并新建<code>issue</code>说明问题之后，删除该分支 </td></tr>
<tr>
<td align="center"><code>update-&lt;module&gt;-&lt;author&gt;</code></td><td align="center"><code>update-docs-zlj</code></td><td align="center">模块更新，常驻工作区，完成后合并至<code>dev</code>、新建<code>issue</code>、删除该分支 </td></tr>
<tr>
<td align="center"><code>new-&lt;module&gt;-&lt;author&gt;</code></td><td align="center"><code>new-lisemsed-zlj</code></td><td align="center">新增模块，常驻工作区，完成后合并至<code>dev</code>、新建<code>issue</code>、删除该分支 </td></tr>
</table>
<p>所以，团队合作的项目分支看起来就像这样：</p>
<div class="image">
<img src="http://i.imgur.com/Ya2n6vm.jpg"  alt="分支管理示意图"/>
</div>
<h3>3.2.分支管理一般步骤</h3>
<ul>
<li>3.2.1. <a href="https://github.com/orgs/lreis2415/teams/watershed_modeling">加入SEIMS开发组</a>，直接<code>clone</code>实验室账号下的SEIMS库（git.com:lreis2415/SEIMS.git）即可，不用<code>fork</code>到自己账号下，建议仅克隆<code>dev</code>分支，因为默认情况下会克隆所有分支，不仅速度慢，而且浪费空间且没必要，操作如下： ```shell git clone <a href="#" onclick="location.href='mai'+'lto:'+'git'+'@g'+'ith'+'ub'+'.co'+'m'; return false;">git@g<span style="display: none;">.nosp@m.</span>ithu<span style="display: none;">.nosp@m.</span>b.com</a>:crazyzlj/SEIMS.git &ndash;branch dev &ndash;single-branch ```</li>
<li><p class="startli">3.2.2. 发现代码中出现了bug、某个文档需要修改、某个模块需要更新、亦或是需要增加一个新的模块等，新建一个分支，修复它，合并至dev分支，并新建issue告知大家，也是备忘，完后删除这个分支，流程如下：</p>
<p class="startli">``` </p>
<h1>假设目前cd到SEIMS所在文件夹了</h1>
<p class="startli">git checkout -b bug-IFoundU-zlj </p>
<h1>修改完成，提交修改</h1>
<p class="startli">git add . git commit -m "bug fixed of IFoundU" </p>
<h1>切换回dev分支，并合并刚才的修改</h1>
<p class="startli">git checkout dev git merge &ndash;no-ff -m "merge from bug-IFoundU-zlj" bug-IFoundU-zlj </p>
<h1>如果出现冲突，处理之后，可以删除bug分支了</h1>
<p class="startli">git branch -d bug-IFoundU-zlj </p>
<h1>去提交一个issue告知大家吧！https://github.com/lreis2415/SEIMS/issues</h1>
<p class="startli">``<code></code></p>
</li>
<li><code>3.2.3.删除远程分支。如果某个分支工作已经完成，且已经合并至</code>dev<code>分支，在本地可以直接通过</code>git branch -d tmpbranch<code>命令删除，远程分支则可推送一个空分支到远程分支，实现删除</code>git push origin :tmpbranch` </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Sep 4 2017 08:29:42 for SEIMS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
